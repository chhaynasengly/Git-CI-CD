global
  stats socket /var/run/api.sock user haproxy group haproxy mode 660 level admin expose-fd listeners
  log stdout format raw local0 info

defaults
  mode http
  timeout client 10s
  timeout connect 5s
  timeout server 10s
  timeout http-request 10s
  log global

frontend myfrontend
  bind :80
  bind :443 ssl crt /usr/local/etc/haproxy/ssl/devopsclass.combine.pem
  redirect scheme https code 301 if !{ ssl_fc }

  acl host_master hdr_beg(host) -i devopsclass.test

  use_backend webservers if host_master

backend webservers
  mode             http
  balance          roundrobin
  option forwardfor

  server s1 app1:8080 check
  server s2 app2:8080 check
  server s3 app3:8080 check
